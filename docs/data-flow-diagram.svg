<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 900">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1f2937; }
      .step-title { font: bold 16px sans-serif; fill: #374151; }
      .text { font: 14px sans-serif; fill: #4b5563; }
      .small-text { font: 12px sans-serif; fill: #6b7280; }
      .code { font: 12px monospace; fill: #059669; }
      
      .step-box { fill: white; stroke: #3b82f6; stroke-width: 3; rx: 8; }
      .user-box { fill: #dbeafe; stroke: #3b82f6; stroke-width: 2; rx: 8; }
      .server-box { fill: #d1fae5; stroke: #10b981; stroke-width: 2; rx: 8; }
      .db-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2; rx: 8; }
      
      .arrow { stroke: #3b82f6; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .return-arrow { stroke: #10b981; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); stroke-dasharray: 5,5; }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3b82f6" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="500" y="40" text-anchor="middle" class="title">NST Stack - Data Flow</text>
  <text x="500" y="65" text-anchor="middle" class="text">‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà User Action ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á UI Update</text>
  
  <!-- Step 1: User Action -->
  <rect x="350" y="100" width="300" height="80" class="user-box" />
  <text x="500" y="130" text-anchor="middle" class="step-title">1. User Action</text>
  <text x="500" y="155" text-anchor="middle" class="text">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "Add Employee"</text>
  <text x="500" y="172" text-anchor="middle" class="small-text">‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞ Submit</text>
  
  <!-- Arrow 1 -->
  <path d="M 500 180 L 500 220" class="arrow" />
  
  <!-- Step 2: Client Component -->
  <rect x="350" y="220" width="300" height="100" class="step-box" />
  <text x="500" y="250" text-anchor="middle" class="step-title">2. Client Component</text>
  <text x="500" y="270" text-anchor="middle" class="code">form.tsx</text>
  <text x="500" y="290" text-anchor="middle" class="text">‚Ä¢ Validate form data</text>
  <text x="500" y="307" text-anchor="middle" class="text">‚Ä¢ Create FormData object</text>
  
  <!-- Arrow 2 -->
  <path d="M 500 320 L 500 360" class="arrow" />
  
  <!-- Step 3: Server Action -->
  <rect x="350" y="360" width="300" height="100" class="server-box" />
  <text x="500" y="390" text-anchor="middle" class="step-title">3. Server Action</text>
  <text x="500" y="410" text-anchor="middle" class="code">createEmployee(formData)</text>
  <text x="500" y="430" text-anchor="middle" class="text">‚Ä¢ Extract data from FormData</text>
  <text x="500" y="447" text-anchor="middle" class="text">‚Ä¢ Prepare for database insert</text>
  
  <!-- Arrow 3 -->
  <path d="M 500 460 L 500 500" class="arrow" />
  
  <!-- Step 4: Supabase Client -->
  <rect x="350" y="500" width="300" height="100" class="server-box" />
  <text x="500" y="530" text-anchor="middle" class="step-title">4. Supabase Server Client</text>
  <text x="500" y="550" text-anchor="middle" class="code">createClient(cookies())</text>
  <text x="500" y="570" text-anchor="middle" class="text">‚Ä¢ Get user session from cookies</text>
  <text x="500" y="587" text-anchor="middle" class="text">‚Ä¢ Attach JWT to request</text>
  
  <!-- Arrow 4 -->
  <path d="M 500 600 L 500 640" class="arrow" />
  
  <!-- Step 5: Database -->
  <rect x="350" y="640" width="300" height="100" class="db-box" />
  <text x="500" y="670" text-anchor="middle" class="step-title">5. PostgreSQL + RLS</text>
  <text x="500" y="690" text-anchor="middle" class="code">INSERT INTO employees</text>
  <text x="500" y="710" text-anchor="middle" class="text">‚Ä¢ Check RLS policies</text>
  <text x="500" y="727" text-anchor="middle" class="text">‚Ä¢ Execute INSERT query</text>
  
  <!-- Return Arrow 1 -->
  <path d="M 650 690 L 750 690 L 750 550 L 650 550" class="return-arrow" />
  <text x="760" y="625" class="small-text">Success/Error</text>
  
  <!-- Step 6: Revalidate -->
  <rect x="50" y="500" width="250" height="80" class="server-box" />
  <text x="175" y="530" text-anchor="middle" class="step-title">6. Revalidate Cache</text>
  <text x="175" y="550" text-anchor="middle" class="code">revalidatePath("/employees")</text>
  <text x="175" y="567" text-anchor="middle" class="text">Clear Next.js cache</text>
  
  <!-- Arrow to Revalidate -->
  <path d="M 350 550 L 300 550" class="arrow" />
  
  <!-- Return Arrow 2 -->
  <path d="M 650 410 L 800 410 L 800 270 L 650 270" class="return-arrow" />
  <text x="810" y="345" class="small-text">Return result</text>
  
  <!-- Step 7: TanStack Query -->
  <rect x="50" y="220" width="250" height="100" class="step-box" />
  <text x="175" y="250" text-anchor="middle" class="step-title">7. TanStack Query</text>
  <text x="175" y="270" text-anchor="middle" class="code">invalidateQueries()</text>
  <text x="175" y="290" text-anchor="middle" class="text">‚Ä¢ Invalidate cache</text>
  <text x="175" y="307" text-anchor="middle" class="text">‚Ä¢ Trigger refetch</text>
  
  <!-- Arrow to TanStack Query -->
  <path d="M 350 270 L 300 270" class="arrow" />
  
  <!-- Return Arrow 3 -->
  <path d="M 175 220 L 175 180 L 350 180 L 350 140" class="return-arrow" />
  <text x="190" y="200" class="small-text">Fresh data</text>
  
  <!-- Step 8: UI Update -->
  <rect x="700" y="100" width="250" height="80" class="user-box" />
  <text x="825" y="130" text-anchor="middle" class="step-title">8. UI Update</text>
  <text x="825" y="155" text-anchor="middle" class="text">‚úÖ Toast notification</text>
  <text x="825" y="172" text-anchor="middle" class="text">üìä Table refreshed</text>
  
  <!-- Arrow to UI Update -->
  <path d="M 650 140 L 700 140" class="arrow" />
  
  <!-- Timeline -->
  <line x1="30" y1="100" x2="30" y2="740" stroke="#e5e7eb" stroke-width="2" />
  <text x="15" y="420" class="small-text" transform="rotate(-90 15 420)">Timeline</text>
  
  <!-- Legend -->
  <rect x="50" y="800" width="900" height="80" fill="#f9fafb" stroke="#e5e7eb" stroke-width="1" rx="4" />
  <text x="70" y="825" class="step-title">Key Points:</text>
  <text x="70" y="845" class="text">‚Ä¢ Server Actions ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á API routes</text>
  <text x="70" y="862" class="text">‚Ä¢ RLS ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô code)</text>
  <text x="500" y="845" class="text">‚Ä¢ revalidatePath() + invalidateQueries() = Fresh data</text>
  <text x="500" y="862" class="text">‚Ä¢ Type-safe ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà Client ‚Üí Server ‚Üí Database</text>
</svg>
